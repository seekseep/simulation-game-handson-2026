# 4. Vercelデプロイ

この節では、作成したアプリケーションをVercelにデプロイ（公開）します。Vercelは静的サイトやWebアプリケーションを簡単にホスティングできるサービスです。

## 学習内容

- Vercelアカウントの作成
- GitHubリポジトリとの連携
- 自動デプロイの設定
- デプロイされたアプリケーションの確認

## 前提条件

- GitHubアカウントがあること
- 前節でGitHubにリポジトリをプッシュしていること

---

# ステップ1: Vercelアカウントの作成

## 目標

Vercelアカウントを作成します。GitHubアカウントと連携することで、簡単にサインアップできます。

## 手順

1. **Vercelのウェブサイトにアクセス**
   - https://vercel.com にアクセスします

2. **サインアップ**
   - 「Sign Up」ボタンをクリック
   - 「Continue with GitHub」を選択
   - GitHubのログイン画面が表示されたらログイン
   - Vercelに必要な権限を許可

3. **プランの確認**
   - Hobby（無料プラン）が自動的に選択されます
   - このプランで十分な機能が使えます

**注意:** すでにVercelアカウントを持っている場合は、このステップをスキップしてログインしてください。

---

# ステップ2: プロジェクトの作成とデプロイ

## 目標

GitHubのリポジトリをVercelにインポートして、アプリケーションをデプロイします。

## 手順

### 1. 新しいプロジェクトを作成

1. **Vercelダッシュボードにアクセス**
   - ログイン後、ダッシュボード（https://vercel.com/dashboard）が表示されます

2. **新しいプロジェクトを追加**
   - 「Add New...」ボタンをクリック
   - 「Project」を選択

3. **GitHubリポジトリをインポート**
   - 「Import Git Repository」セクションで、GitHubのリポジトリ一覧が表示されます
   - 前節で作成した `simulation-game`（または自分のリポジトリ名）を探します
   - 「Import」ボタンをクリック

**注意:** リポジトリが表示されない場合は、「Adjust GitHub App Permissions」をクリックして、Vercelがリポジトリにアクセスできるように権限を設定してください。

### 2. プロジェクトの設定

プロジェクト設定画面が表示されます。

1. **Project Name**
   - デフォルトでリポジトリ名が入力されています
   - 変更しても良いですが、そのままでも問題ありません

2. **Framework Preset**
   - 「Other」が選択されていることを確認
   - 今回は特定のフレームワークを使っていないので、このままでOKです

3. **Root Directory**
   - `app` ディレクトリを指定する必要があります
   - 「Edit」ボタンをクリック
   - `app` と入力

4. **Build and Output Settings**
   - 今回は静的サイトなので、特に設定は不要です
   - デフォルトのままでOKです

5. **Environment Variables**
   - 今の時点では環境変数は不要です
   - 空欄のままでOKです

### 3. デプロイを開始

1. **「Deploy」ボタンをクリック**
   - デプロイが開始されます
   - 進行状況が画面に表示されます

2. **デプロイの完了を待つ**
   - 通常、1〜2分程度で完了します
   - 「Congratulations!」という画面が表示されたら成功です

### 4. デプロイされたアプリケーションを確認

1. **プレビューをクリック**
   - デプロイ完了画面にプレビュー画像が表示されます
   - クリックするとアプリケーションが開きます

2. **URLを確認**
   - `https://your-project-name.vercel.app` のようなURLが割り当てられます
   - このURLを友達と共有できます

## 動作確認

1. **アプリケーションにアクセス**
   - ブラウザでVercelのURLを開く
   - 動物が表示されることを確認

2. **機能をテスト**
   - 動物をクリックしてメニューを開く
   - 単語を教える
   - 「話す」ボタンをクリックして、セリフが表示されることを確認

3. **localStorageの動作確認**
   - 単語を教える
   - ページを再読み込みする
   - 「話す」ボタンをクリックして、教えた単語が保存されていることを確認

---

# 自動デプロイの仕組み

VercelはGitHubと連携しているため、コードを更新すると自動的にデプロイされます。

## 自動デプロイの流れ

1. **コードを変更してコミット**
   ```bash
   git add .
   git commit -m "セリフのテンプレートを追加"
   ```

2. **GitHubにプッシュ**
   ```bash
   git push
   ```

3. **Vercelが自動的にデプロイ**
   - GitHubにプッシュすると、Vercelが自動的に検知
   - 新しいバージョンがビルド＆デプロイされます
   - 1〜2分後に本番環境に反映されます

4. **デプロイ状況を確認**
   - Vercelダッシュボードの「Deployments」タブで確認できます
   - デプロイが成功すると「Ready」と表示されます

## プレビューデプロイ

- `main` ブランチ以外のブランチにプッシュすると、プレビュー環境が自動生成されます
- プレビュー環境のURLは、本番環境とは別に割り当てられます
- これにより、本番環境に影響を与えずに変更をテストできます

---

# カスタムドメインの設定（オプション）

Vercelでは、独自のドメイン名を設定することもできます。

## 手順

1. **プロジェクトの設定を開く**
   - Vercelダッシュボードでプロジェクトを選択
   - 「Settings」タブをクリック

2. **ドメインを追加**
   - 「Domains」セクションに移動
   - 「Add」ボタンをクリック
   - 独自ドメイン名を入力（例: `my-simulation-game.com`）
   - 指示に従ってDNS設定を行う

**注意:** 独自ドメインの取得には、別途ドメイン登録サービス（Google Domains、Namecheap など）での契約が必要です。

---

# よくあるエラーと対処法

## エラー1: 404 Not Found

**原因:** Root Directoryが正しく設定されていない可能性があります。

**対処法:**
1. Vercelダッシュボードでプロジェクトを選択
2. 「Settings」→「General」に移動
3. 「Root Directory」を `app` に設定
4. 「Save」をクリック
5. 「Deployments」タブで最新のデプロイを「Redeploy」

## エラー2: ファイルが見つからない

**原因:** GitHubにファイルがプッシュされていない可能性があります。

**対処法:**
1. ローカルで `git status` を実行
2. プッシュされていないファイルがあれば、`git add .` と `git commit` を実行
3. `git push` でGitHubにプッシュ
4. Vercelが自動的に再デプロイします

## エラー3: GLBファイルが読み込めない

**原因:** GLBファイルのパスが間違っている可能性があります。

**対処法:**
1. `avater.js` のパスが正しいか確認
   ```javascript
   roomGlbUrl: './assets/glb/room.glb',
   ```
2. `app/assets/glb/` ディレクトリにGLBファイルが存在するか確認
3. ファイルがGitHubにプッシュされているか確認

## エラー4: 3Dモデルが表示されない

**原因:** Three.jsのバージョンやImport Mapの問題の可能性があります。

**対処法:**
1. ブラウザの開発者ツール（F12）でエラーメッセージを確認
2. コンソールにエラーが表示されている場合は、そのメッセージを元に修正
3. `index.html` のImport Mapが正しく設定されているか確認

---

# デプロイメントの管理

## デプロイ履歴の確認

1. **Deploymentsタブを開く**
   - Vercelダッシュボードでプロジェクトを選択
   - 「Deployments」タブをクリック

2. **デプロイ一覧を確認**
   - 各デプロイの日時、コミットメッセージ、ステータスが表示されます
   - クリックすると詳細情報とログが見れます

## ロールバック（以前のバージョンに戻す）

1. **以前のデプロイを選択**
   - 「Deployments」タブで戻したいバージョンを探す

2. **Promoteを実行**
   - デプロイの詳細画面で「...」メニューをクリック
   - 「Promote to Production」を選択
   - これで以前のバージョンが本番環境に戻ります

---

# まとめ

この節では、Vercelを使ってアプリケーションをインターネット上に公開しました。

**学んだこと:**

1. **Vercelアカウントの作成**: GitHubアカウントと連携
2. **プロジェクトのデプロイ**: GitHubリポジトリからインポート
3. **Root Directoryの設定**: `app` ディレクトリを指定
4. **自動デプロイ**: GitHubにプッシュすると自動的に反映
5. **デプロイ管理**: 履歴確認とロールバック

おめでとうございます！これで第2章が完了です。

アプリケーションは以下のように動作します:
- インターネット上で誰でもアクセス可能
- GitHubにコードをプッシュすると自動的に更新
- localStorageで教えた単語が保存される

次の第3章では、サーバー側の機能（API）を追加して、さらに機能を拡張していきます。

# 次の項

[第3章: API構築](../../3-api/README.md)
