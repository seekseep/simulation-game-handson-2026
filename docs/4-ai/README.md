# 第4章: AI連携

## この章について

第4章では、Google AI StudioのGemini APIを使って、AIによるセリフ生成機能を実装します。

第3章までで、データベースと連携したAPIを構築しました。この章では、テンプレートと単語を組み合わせたセリフをAIで変換し、キャラクターに個性を持たせる機能を追加します。

セリフ生成の責任をAPI側に移動することで、セキュリティを確保しながらAI機能を実装する方法を学びます。

## 学習内容

この章では、以下のことを学びます:

- Google AI Studioアカウントの作成とAPIキーの取得
- Gemini API（大規模言語モデル）の基本的な使い方
- npmによるGemini SDKのインストール
- プロンプトエンジニアリングの基礎
- セリフ生成ロジックのAPI側への移動
- ブラウザとサーバーの責任分離
- APIエンドポイントの設計変更
- 環境変数による秘匿情報の管理
- 本番環境へのAI機能のデプロイ

## 前提条件

- 第3章を完了していること
- Googleアカウントを持っていること（Google AI Studio用）
- Vercel CLIとSupabaseの設定が完了していること

## この章で作るもの

この章では、以下の機能を実装します:

1. **セリフ生成API** (`/api/lines`) - テンプレートと単語を組み合わせたセリフを生成
2. **AI変換機能** - Gemini APIを使ってセリフをキャラクターの性格に合わせて変換
3. **UI側の修正** - セリフ生成の責任をAPI側に移動
4. **セキュリティ対応** - ブラウザ側でAPIキーを扱わないようにする

例えば、テンプレート「おはようからおやすみまで『{言葉}』でお送りしています」と単語「おざまーっす」を組み合わせたセリフを、AIが「おはようからおやすみまで『おざまーっす』でお送りしてるよ〜♪みんな元気出していこうね!」のように、明るく元気なキャラクター風に変換します。

## ディレクトリについて

第3章で作成した `app` ディレクトリを引き続き使用します。既存のAPIエンドポイントを修正し、新しいエンドポイントを追加します。

```
./
└── handson-2026
    ├── app
    │   ├── api
    │   │   ├── gemini.js       ← この章で作成
    │   │   ├── lines.js        ← この章で作成
    │   │   ├── word-categories.js
    │   │   ├── words.js        ← この章で修正
    │   │   └── supabase.js
    │   ├── assets
    │   │   └── js
    │   │       ├── api.js      ← この章で修正（storage.jsから名前変更）
    │   │       └── main.js     ← この章で修正
    │   └── index.html
    └── practice
```

## 章の構成

この章は以下の2つの節で構成されています。順番に進めてください。

1. [セリフ生成の責任の移動](1-line/README.md) - セリフ生成のロジックをUI側からAPI側に移動します。AIを使うための準備として、秘匿情報をブラウザ側で扱わないようにアーキテクチャを変更します。
2. [AI連携](2-ai-line/README.md) - Google AI StudioのGemini APIを使って、セリフをキャラクターの性格に合わせて変換する機能を実装します。環境変数の設定から本番環境へのデプロイまで行います。

---

## まとめ

この章では、AIを活用したセリフ生成機能を実装しました。

セリフ生成の責任をAPI側に移動することで、セキュリティを確保しながらAI機能を実装する方法を学びました。また、Gemini APIを使ってテンプレートベースのセリフに個性を持たせる方法を習得しました。

これで、シミュレーションゲームハンズオンの全4章が完了です。

第1章の基礎練習から始まり、第2章でUIを構築し、第3章でAPIとデータベースを連携させ、第4章でAI機能を追加しました。これらの技術を組み合わせることで、モダンなWebアプリケーションを構築できるようになりました。
