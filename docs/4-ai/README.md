# 第4章: AI統合

## この章について

第4章では、Google Gemini AI を使って、キャラクターに性格を持たせます。

これまでは、あらかじめ用意したテンプレート文章をそのまま使っていました。
この章では、AIがキャラクターの性格に合わせてセリフを変換するようになります。

**例:**
- **元のセリフ:** 「おはようからおやすみまで『おざまーっす』でお送りしています」
- **AI変換後:** 「おはようからおやすみまで『おざまーっす』でお送りしてるよ〜♪みんな元気出していこうね!」

## 学習内容

この章では、以下のことを学びます:

- サーバーサイドへのロジック移動
- Google Gemini AI の基本
- AI API の使い方
- プロンプトエンジニアリング（AIへの指示の書き方）
- ストリーミングなしのテキスト生成
- API キーの取得と管理

## 前提条件

- 第3章を完了していること
- Google アカウント（Gmail があれば OK）
- Google AI Studio でのAPIキー取得（この章で説明します）

## この章で作るもの

この章では、以下の機能を追加・変更します:

### 1. セリフ生成API（サーバーサイド）
フロントエンドにあったセリフ生成ロジックをサーバーに移動します。

**メリット:**
- セキュリティの向上（データベースアクセスがサーバーのみ）
- コードの整理（ロジックとUIの分離）
- AI統合の準備

### 2. AI によるセリフ変換
Gemini AI を使って、キャラクターの性格に合わせてセリフを変換します。

**キャラクターの性格設定例:**
```
明るく元気で前向きなキャラクター。
語尾に「!」や「♪」をつけることが多く、
テンションが高くエネルギッシュな言葉遣いをします。
```

## セクション

この章は以下の2つのセクションで構成されています。順番に進めてください。

### 1. [セリフ生成API](./1-line/README.md)
セリフ生成のロジックをサーバーサイドに移動します。

**学ぶこと:**
- フロントエンドからバックエンドへのロジック移動
- POST APIの実装
- データベースクエリの最適化（Promise.all）
- カテゴリーフィルタリング
- ランダム選択のサーバーサイド実装

**サンプル数:** 2

---

### 2. [AI統合](./2-ai-line/README.md)
Google Gemini AI を統合して、セリフを変換します。

**学ぶこと:**
- Google AI Studio でのAPIキー取得
- `@google/generative-ai` パッケージの使い方
- Gemini モデルの初期化
- プロンプトの作成
- テキスト生成の実行
- 環境変数での APIキー管理

**サンプル数:** 1

---

## 開発の流れ

この章では、以下の流れで開発を進めます:

1. **セクション1: セリフ生成API** - ロジックをサーバーに移動する（2ステップ）
2. **セクション2: AI統合** - AIでセリフを変換する（1ステップ）

## 重要な概念

### 生成AIとは

生成AIは、新しいテキスト、画像、音声などを作り出すAIです。
この章では、Google の Gemini AI を使ってテキストを生成します。

**特徴:**
- 自然な文章を生成できる
- 指示（プロンプト）に従って出力を調整できる
- 創造性とランダム性がある

### プロンプトエンジニアリングとは

AIへの指示（プロンプト）を工夫することで、より良い結果を得る技術です。

**良いプロンプトの条件:**
- **具体的** - 何をしてほしいかを明確に伝える
- **例を示す** - どんな結果がほしいかを例で示す
- **制約を伝える** - やってほしくないことも伝える

**この章のプロンプト例:**
```
あなたは明るく元気で前向きなキャラクターです。
語尾に「!」や「♪」をつけることが多く、
テンションが高くエネルギッシュな言葉遣いをします。

以下のセリフを、この性格に合わせて言い換えてください。
セリフだけを返してください。説明や前置きは不要です。

元のセリフ: {baseMessage}
```

### APIキーのセキュリティ

APIキーは、AIサービスを使うための鍵です。第三者に知られると悪用される可能性があります。

**守るべきこと:**
- **環境変数で管理** - コードに直接書かない
- **Git にコミットしない** - `.env.local` を `.gitignore` に含める
- **公開しない** - GitHub などに公開しない

### サーバーサイドロジックの利点

ロジックをサーバーサイドに移動することで、以下のメリットがあります:

1. **セキュリティ** - APIキーやデータベース接続情報を隠せる
2. **パフォーマンス** - 重い処理をサーバーで実行できる
3. **一貫性** - ビジネスロジックをサーバーで一元管理できる

---

## おめでとうございます!

第4章が終わったら、ハンズオンは完了です!

あなたは以下のことができるようになりました:

- **Web開発の基礎** - HTML/CSS/JavaScript
- **3D グラフィックス** - Three.js
- **API開発** - Vercel Serverless Functions
- **データベース** - Supabase (PostgreSQL)
- **AI統合** - Google Gemini AI
- **デプロイ** - Vercel, GitHub

これらのスキルを使って、自分だけのアプリケーションを作ってみましょう!
