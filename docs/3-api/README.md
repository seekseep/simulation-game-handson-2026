# 第3章: API構築

## この章について

第3章では、データをサーバー側で管理するAPIを構築します。

第2章で作成したアプリケーションは、ブラウザのlocalStorageでデータを管理していました。この章では、Vercel Serverless FunctionsとSupabaseを使って、サーバー側でデータを管理できるようにします。

APIの実装からデータベース設計、環境変数の設定まで、段階的に進めていきます。各ステップで動作確認を行いながら、実際に動くバックエンドシステムを構築できます。

## 学習内容

この章では、以下のことを学びます:

- Vercel CLIを使ったローカル開発環境の構築
- Vercel Serverless Functionsの基本（GET/POSTメソッド）
- RESTful APIの設計とエンドポイントの作成
- Supabaseアカウントの作成とプロジェクト設定
- PostgreSQLデータベースの基本とテーブル設計
- SQLによるテーブル作成とデータ挿入
- ER図によるデータモデリング
- Supabase JavaScript SDKの使い方
- npmによるパッケージ管理
- 環境変数を使った秘匿情報の管理
- データベースとAPIの連携
- snake_caseとcamelCaseの変換
- 非同期処理とデータベースクエリ
- 本番環境への環境変数の設定とデプロイ

## 前提条件

- 第2章を完了していること
- GitHubアカウントとVercelアカウントを持っていること
- Node.jsがインストールされていること

Supabaseのアカウントは、この章の途中で作成する手順を説明します。

## この章で作るもの

この章では、以下のAPIエンドポイントを作成し、データベースと連携させます:

1. **言葉カテゴリAPI** (`/api/word-categories`) - カテゴリの一覧を取得
2. **テンプレートAPI** (`/api/templates`) - 会話テンプレートの一覧を取得
3. **言葉API** (`/api/words`) - 言葉の一覧を取得、新しい言葉を登録
4. **データベース連携** - Supabase PostgreSQLを使ったデータの永続化
5. **環境変数管理** - 秘匿情報を安全に管理

localStorageで管理していたデータをサーバー側で管理することで、複数のデバイスでデータを共有できるようになります。また、データベースを使うことで、データの永続性と拡張性が向上します。

## ディレクトリについて

第2章で作成した `app` ディレクトリを引き続き使用します。この中に `api` ディレクトリを作成して、APIエンドポイントを実装していきます。

次のようなディレクトリ構造になります。

```
./
└── handson-2026
    ├── app
    │   ├── api          ← この章で作成
    │   ├── assets
    │   └── index.html
    └── practice
```

## 章の構成

この章は以下の5つの節で構成されています。順番に進めてください。

1. [Vercel CLI](1-vercel-cli/README.md) - ローカル開発環境の構築方法を学びます。Node.jsとVercel CLIをインストールし、ローカルでAPIの動作確認ができる環境を整えます。
2. [APIの実装](2-api/README.md) - Vercel Serverless Functionsを使ったAPI実装を学びます。データ構造の整理から始め、GET/POSTメソッドを使った基本的なエンドポイントを段階的に作成します。
3. [Supabaseの用意](3-supabase/README.md) - Supabaseアカウントの作成から、プロジェクトの設定、APIキーの取得までを行います。データベースを使う準備を整えます。
4. [データベース連携](4-database/README.md) - PostgreSQLによるテーブル設計とSQL実行、Supabase SDKを使ったAPIとデータベースの連携を学びます。データの永続化を実現します。
5. [環境変数の設定](5-environment/README.md) - 本番環境での環境変数の設定方法を学びます。Vercelダッシュボードで環境変数を設定し、本番環境にデプロイします。

---

## 次の章

第3章が終わったら、[第4章: AI連携](../4-ai/README.md) に進みましょう。

第4章では、Google AI StudioのGemini APIを使って、AIによるセリフ生成機能を追加します。
