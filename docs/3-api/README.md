# 第3章: API構築

## この章について

第3章では、データをサーバーで管理できるようにします。

第2章で作ったアプリケーションは、ブラウザだけでデータを保存していました（localStorage）。
この章では、サーバー上のAPIとデータベースを使って、データを永続的に管理する方法を学びます。

## 学習内容

この章では、以下のことを学びます:

- Vercel CLI を使ったローカル開発環境の構築
- サーバーレス関数（API）の作成
- REST API の基本（GET, POST）
- Supabase データベースの設定
- PostgreSQL データベースの基本
- データベースとの連携（CRUD操作）
- 環境変数の管理

## 前提条件

- 第2章を完了していること
- Supabaseアカウント（無料） - https://supabase.com/

Supabaseのアカウントは、この章の途中で作成する手順を説明します。

## この章で作るもの

この章では、第2章のアプリケーションにバックエンド機能を追加します:

### 追加する機能

1. **API エンドポイント**
   - `/api/words` - 単語の取得と追加
   - `/api/word-categories` - カテゴリー一覧の取得
   - `/api/templates` - セリフテンプレートの取得

2. **データベース**
   - `word_categories` テーブル - カテゴリー情報
   - `words` テーブル - 単語情報
   - `templates` テーブル - セリフのテンプレート情報

3. **環境変数管理**
   - Supabase の接続情報を安全に管理

### localStorage から API+データベースへ

**第2章まで:**
- データはブラウザのlocalStorageに保存
- ブラウザを変えたり、デバイスを変えるとデータが消える

**第3章以降:**
- データはサーバーのデータベースに保存
- どのブラウザ、どのデバイスからでも同じデータにアクセスできる

## セクション

この章は以下の5つのセクションで構成されています。順番に進めてください。

### 1. [Vercel CLI](./1-vercel-cli/README.md)
Vercel CLI をインストールして、ローカル開発環境を構築します。

**学ぶこと:**
- Vercel CLI のインストール
- `vercel dev` コマンドの使い方
- ローカルでの API 開発環境
- サーバーレス関数の基本

**サンプル数:** 説明のみ（実作業あり）

---

### 2. [API作成](./2-api/README.md)
サーバーレス関数を使ってAPIエンドポイントを作成します。

**学ぶこと:**
- Vercel Serverless Functions の作成
- GET リクエストの処理
- POST リクエストの処理
- JSON データの送受信
- フロントエンドからのAPI呼び出し

**サンプル数:** 7

---

### 3. [Supabase設定](./3-supabase/README.md)
Supabaseアカウントを作成し、データベースを設定します。

**学ぶこと:**
- Supabaseアカウントの作成
- プロジェクトの作成
- データベースの設定
- 接続情報の確認

**サンプル数:** 説明のみ（実作業あり）

---

### 4. [データベース統合](./4-database/README.md)
APIとデータベースを連携させます。

**学ぶこと:**
- Supabase クライアントの使い方
- データベーステーブルの作成（SQL）
- データの挿入、取得、更新、削除（CRUD）
- テーブル間の関連（外部キー）
- フロントエンドの修正

**サンプル数:** 4

---

### 5. [環境変数設定](./5-environment/README.md)
環境変数を使って、接続情報を安全に管理します。

**学ぶこと:**
- 環境変数とは
- `.env.local` ファイルの使い方
- Vercel での環境変数設定
- セキュリティの基本

**サンプル数:** 説明のみ（実作業あり）

---

## 開発の流れ

この章では、以下の流れで開発を進めます:

1. **セクション1: Vercel CLI** - ローカル開発環境を準備する
2. **セクション2: API作成** - APIエンドポイントを作る（7ステップ）
3. **セクション3: Supabase設定** - データベースを準備する
4. **セクション4: データベース統合** - APIとデータベースを連携する（4ステップ）
5. **セクション5: 環境変数設定** - セキュリティ設定をする

## 重要な概念

### サーバーレス関数とは

従来のサーバーは24時間動き続けていましたが、サーバーレス関数は必要なときだけ動きます。
Vercelが自動でサーバーを管理してくれるので、私たちはコードを書くだけで大丈夫です。

**メリット:**
- サーバーの管理が不要
- 使った分だけ料金（無料枠が大きい）
- 自動でスケール（アクセスが増えても対応）

### REST API とは

REST APIは、フロントエンドとバックエンドが通信するための仕組みです。

**基本的な操作:**
- **GET** - データを取得する
- **POST** - 新しいデータを作成する
- **PUT** - データを更新する
- **DELETE** - データを削除する

### データベースとは

データベースは、データを整理して保存する仕組みです。
表（テーブル）のような形でデータを管理します。

**Supabaseの特徴:**
- PostgreSQL データベース（信頼性が高い）
- 無料で始められる
- 管理画面が使いやすい
- リアルタイム機能もある

---

## 次の章

第3章が終わったら、[第4章: AI統合](../4-ai/README.md) に進みましょう。

第4章では、Google Gemini AI を使って、キャラクターに性格を持たせます。
